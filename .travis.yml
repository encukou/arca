env:
  global:
  - DOCKER_HUB_USERNAME=arcaoss
  - secure: Eg+cSMQWR+wwPumHay12C7EGV82MZqqw5BiS9NMdveNeNAJsb29ykDR52JL39vZNtHNli8iaykBXU9L+2KhkSIExnQevi0lptMdENKSNvGMp+QU4VOcwqXhQ124jrQhDdl1AcHdnsk84xBIAFV/70sCljOw/SktCYUbHX0tZK5XXOeWNcuLEhWIz0MxZuRgGIsGLK8of07b8uPrnNFCm5zHaTa0w9IGASVWHW6sM+O4RZLjKpFfn9vI/kdvbQv/3I+UePXbU4lSglWXzVMSD5Z0gjMs2ppMMefn8f53IHTuyCiFiOV/Kl/PWs6XCCp6G1T1uhrTx/KYGTYYa/Nic8caoAGGFYgjsQyTfGiiV8lj6b91kPCRte3FrUvtrwWl/fmMLMAZpztowQYWUiP+9SXkYOIV+Nm4iRNJ6Px2oS/lV40uBIOmipIApC+xU7WH0asxVkY+SsXUXZtgzFbzyWKddnsVfYCxBMOj/+1wG0l58ZQNcbkMqWXQuaBHywwqIkB56QMnFmnsaa21uDg9iS1HEx2jXrOQCMIcXaG8Xu6fDR9VQ1IDapJDT5eqi/WAm4WcfB3g8qnopKP/oAK0qdJCqW4AgSS3tMd/TeqKzbw1aAY3iLDZ1h7NwTerNLc9wsHv7FE/eMOV7wNuYXw6+jj/H5V+b217muiy38cEMw3E=
language: python
dist: xenial
python:
- '3.6'
- '3.7'
- '3.8'

cache:
- pip
notifications:
  email: false
sudo: required
services:
- docker
install:
- pip install codecov mypy
- pip install -r requirements.txt  # so travis pip cache can actually cache something
- python setup.py install
before_script:
- docker login -u "$DOCKER_HUB_USERNAME" -p "$DOCKER_HUB_PASSWORD"
script:
- python setup.py test 2>error.log
- mypy arca || echo "Optional MyPy check failed"
after_script:
- cat error.log
- sleep 1
after_success:
- codecov
branches:
  only:
  - master
  - /release-v[0-9]+/
deploy:
  provider: script
  skip_cleanup: true
  script: python setup.py deploy_docker_bases
  on:
    branch: master
    repo: mikicz/arca
    python: '3.7'
